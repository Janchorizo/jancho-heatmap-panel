{"version":3,"sources":["../../../src/features/render/renderController.ts"],"names":["MetricsPanelCtrl","TimeSeries","_","d3","renderDefaults","renderEditor","Feature","$scope","panelController","ctrl","panel","defaults","events","on","onInitEditMode","bind","onPanelInitialized","onRender","console","log","addEditorTab","info","renderSala","panelDivId","mappedData","actualizarColores","cargarPlano","render","baseMapRoute","mapRoute","discrete_continuous","scaleColor","value","thresholds","colors","scaleLinear","domain","range","target","dir","document","getElementById","xml","mimeType","get","error","div","removeChild","childNodes","appendChild","documentElement","data","salas","select","selectAll","d","identificador","id","t","transition","duration","ease","easeLinear","style","$","proxy","valor"],"mappings":"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","file":"renderController.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport TimeSeries from 'app/core/time_series2';\nimport _ from 'lodash';\nimport * as d3 from '../../libs/d3/build/d3.js' ;\n\nimport { renderDefaults } from \"./renderDefaults.js\";\nimport { renderEditor } from \"./renderEditor.js\";\n\nexport default class Feature{\n  constructor( $scope){\n      this.$scope = $scope;\n      this.panelController = $scope.ctrl;\n      this.panel = this.panelController.panel;\n      _.defaults( this.panelController.panel, renderDefaults);\n\n      this.panelController.events.on( 'init-edit-mode', this.onInitEditMode.bind(this));\n      //this.panelController.events.on( 'data-received', this.onDataReceived);\n      this.panelController.events.on( 'panel-initialized', this.onPanelInitialized.bind(this));\n      this.panelController.events.on( 'render', this.onRender.bind(this));\n      //this.panelController.events.on( 'refresh', this.onRefresh);\n      console.log('hola, feature iniciada');\n  }\n\n  onInitEditMode(){\n    this.panelController.addEditorTab( 'Render', renderEditor( this.$scope), 2);\n  }\n\n  onRender(){\n    console.info('renderizando sala ...');\n    this.renderSala( '#'+this.panel.panelDivId, this.panel.mappedData);\n    console.info('renderizado completado');\n  }\n\n  onPanelInitialized(){\n    this.actualizarColores();\n    this.cargarPlano( this.panel.panelDivId, this.panel.render.baseMapRoute + this.panel.render.mapRoute);\n    this.panelController.render();\n  }\n\n  actualizarColores(){\n    if(this.panel.render.discrete_continuous == true){\n      this.scaleColor = (function( value){\n        if( value <= this.panel.render.thresholds[0]){\n          return( this.panel.render.colors[0]);\n        }else if( value <= this.panel.render.thresholds[1]){\n          return( this.panel.render.colors[1]);\n        }else{\n          return( this.panel.render.colors[2]);\n        }\n      });\n    }else{\n      this.scaleColor =  d3.scaleLinear()\n        .domain( this.panel.render.domain)\n        .range( this.panel.render.colors);\n    }\n  }\n\n  cargarPlano( target, dir){\n    // target => class name\n    console.log( \"rendering on \" + target);\n    console.log( document.getElementById( target));\n    d3.xml( dir).mimeType( \"image/svg+xml\").get( function( error, xml){\n      if( error){ throw( error);}\n      let div = document.getElementById(target);\n      div.removeChild(div.childNodes[0]);\n      div.appendChild(xml.documentElement);\n    });\n  }\n\n  renderSala (target, data){\n    console.log('Fase 1 ...');\n    //Binding\n    var salas = d3.select(target+' svg').selectAll('rect')\n      .data(data, function(d){ return d ? d.identificador : this.id; });\n\n    console.log('Fase 1 update ...');\n    //Update\n    var t = d3.transition()\n      .duration(750)\n      .ease(d3.easeLinear);\n\n    salas\n      .transition(t)\n      .style('fill', $.proxy( function(d){ return this.scaleColor( d.valor)}, this));\n\n    console.log('Fase 2 ...');\n    var salas = d3.select(target+' svg').selectAll('path')\n      .data(data, function(d){ return d ? d.identificador : this.id; });\n\n    console.log('Fase 2 update...');\n    //Update\n    var t = d3.transition()\n      .duration(750)\n      .ease(d3.easeLinear);\n\n    salas\n      .transition(t)\n      .style('fill', $.proxy( function(d){ return this.scaleColor( d.valor)}, this));\n  }\n}\n"]}