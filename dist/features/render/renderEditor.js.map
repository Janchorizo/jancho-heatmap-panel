{"version":3,"sources":["../../../src/features/render/renderEditor.ts"],"names":["renderEditor","scope","pathToTemplate","ctrl","panel","type","restrict","templateUrl","controller","RenderEditorController","d3","$scope","editor","panelCtrl","temp","render","colors","discrete_continuous","actualizarColores","target","panelDivId","dir","baseMapRoute","mapRoute","xml","mimeType","get","error","root","document","getElementById","div","getElementsByClassName","hasChildNodes","removeChild","firstChild","appendChild","documentElement","window","fetch","mapUrl","then","response","text","insertAdjacentHTML","svg","source","local","remote","actualizarMapa","importarMapa","renderFeature","scaleColor","value","thresholds","scaleLinear","domain","range"],"mappings":"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","file":"renderEditor.js","sourcesContent":["import * as d3 from '../../libs/d3/build/d3.js' ;\n\n/**\n * @alias renderEditor\n * @classdesc <h2>render editor controller</h2>\n * Implementation for a feature editor.<br>\n * Controller for the editor tab of the plugin for this specific feature. <br>\n * <i>It is the controller of the AngularJS component for the editor</i>\n * <br>\n * @requires D3.js\n */\nexport class RenderEditorController {\n\n  /**\n   * constructor - description\n   *\n   * @param  {type} $scope A reference to the plugin's scope for editing panel's variables\n   * @return {type}        New instance of RenderEditorController\n   * @memberof renderEditor\n   */\n  constructor( $scope) {\n    $scope.editor = this;\n    this.panelCtrl = $scope.ctrl;\n    this.panel = $scope.ctrl.panel;\n  }\n\n  /**\n   * invertirColores - handler for an editor tab event <br>\n   * Reverts the order of the colors applied on the scale.\n   *\n   * @memberof renderEditor\n   */\n  invertirColores(){\n    let temp = this.panel.render.colors[0];\n    this.panel.render.colors[0] = this.panel.render.colors[2];\n    this.panel.render.colors[2] = temp;\n    if(this.panel.render.discrete_continuous != true){\n      this.actualizarColores();\n    }\n    this.panelCtrl.render();\n  }\n\n  /**\n   * actualizarMapa - handler for an editor tab event <br>\n   * Loads the svg resource on the DOM, after flushing the older one.<br>\n   * It is follwed by a render event call.\n   *\n   * @memberof renderEditor\n   */\n  actualizarMapa(){\n    let target = this.panel.panelDivId;\n    let dir = this.panel.render.baseMapRoute + this.panel.render.mapRoute + \".svg\";\n\n    d3.xml( dir).mimeType( \"image/svg+xml\").get( function( error, xml){\n      if( error){ throw( error);}\n      let root = document.getElementById(target);\n      let div = root.getElementsByClassName('image')[0]\n      while (div.hasChildNodes()) {  \n        div.removeChild(div.firstChild);\n      } \n      div.appendChild(xml.documentElement);\n    });\n    this.panelCtrl.render();\n  }\n\n  /**\n   * importarMapa - handler for an editor tab event <br>\n   * Loads the svg resource on the DOM, after flushing the older one, and\n   * retrieving the svg from the url given.<br>\n   * It is follwed by a render event call.\n   *\n   * @memberof renderEditor\n   */\n  importarMapa(){\n\n    window.fetch(this.panel.render.mapUrl)\n    .then((response) => response.text())\n    .then(svg => {\n        let target = this.panel.panelDivId;\n          let root = document.getElementById(target);\n          let div = root.getElementsByClassName('image')[0]\n\n        while (div.hasChildNodes()) {  \n            div.removeChild(div.firstChild);\n        } \n        div.insertAdjacentHTML(\"afterbegin\", svg);\n        this.panelCtrl.render();\n    });\n  }\n\n  cambiarFuente(){\n    if(this.panel.render.source.local === true){\n        this.panel.render.source.remote = false;\n        this.actualizarMapa();\n    }else if(this.panel.render.source.local === false){\n        this.panel.render.source.remote = true;\n        this.importarMapa();\n    }\n  }\n\n  /**\n   * actualizarColores - handler for an editor tab event <br>\n   * Changes the instance of color scale to be used by D3.<br>\n   * For discrete representation (fixed number of colors) an ad-hoc function is done.<br>\n   * For continous representation (range of colors) a D3.js scale function is used, based on <br>\n   * domain and color selected.\n   *\n   * @memberof renderEditor\n   */\n  actualizarColores(){\n    if(this.panel.render.discrete_continuous == true){\n      this.panelCtrl.renderFeature.scaleColor = (function( value){\n        if( value <= this.panel.render.thresholds[0]){\n          return( this.panel.render.colors[0]);\n        }else if( value <= this.panel.render.thresholds[1]){\n          return( this.panel.render.colors[1]);\n        }else{\n          return( this.panel.render.colors[2]);\n        }\n      });\n    }else{\n      this.panelCtrl.renderFeature.scaleColor =  d3.scaleLinear()\n        .domain( this.panel.render.domain)\n        .range( this.panel.render.colors);\n    }\n    this.panelCtrl.render();\n  }\n}\n\n/**\n * renderEditor - function exported to be used as the AngularJs component\n *\n * @param  {type} scope A reference to the scope of the plugin to route functions and variables\n * @return AngularJS Component       New renderEditor\n * @memberof renderEditor\n */\nexport function renderEditor( scope){\n  'use strict';\n  let pathToTemplate = 'public/plugins/' + scope.ctrl.panel.type + '/features/render/renderEditor.html';\n  return function(){\n    return{\n      restrict: 'E',\n      scope: true,\n      templateUrl: pathToTemplate,\n      controller: RenderEditorController,\n    };\n  };\n}\n"]}