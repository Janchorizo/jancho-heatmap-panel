{"version":3,"sources":["../../../src/features/mapping/mappingController.ts"],"names":["MetricsPanelCtrl","TimeSeries","_","mappingDefaults","mappingEditor","Feature","$scope","panelController","ctrl","panel","defaults","events","on","onInitEditMode","bind","onDataReceived","onRefresh","addEditorTab","dataList","mapData","render","data","processingOnGoing","window","setTimeout","mappedData","mapping","mapByAlias","i","targets","correspondance","series","refId","index","map","s","indexOf","t","alias","push","valueMaps","metric","target"],"mappings":"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","file":"mappingController.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport TimeSeries from 'app/core/time_series2';\nimport _ from 'lodash';\n//import * as d3 from './libs/d3/build/d3.js' ;\n\nimport { mappingDefaults } from \"./mappingDefaults.js\";\nimport { mappingEditor } from \"./mappingEditor.js\";\n\nexport default class Feature{\n  constructor( $scope){\n      this.$scope = $scope;\n      this.panelController = $scope.ctrl;\n      this.panel = this.panelController.panel;\n      _.defaults( this.panelController.panel, mappingDefaults);\n\n      this.panelController.events.on( 'init-edit-mode', this.onInitEditMode.bind(this));\n      this.panelController.events.on( 'data-received', this.onDataReceived.bind(this));\n      this.panelController.events.on( 'refresh', this.onRefresh.bind(this));\n\n  }\n\n  onInitEditMode(){\n      this.panelController.addEditorTab( 'Mapping', mappingEditor( this.$scope), 2);\n  }\n\n  onDataReceived( dataList){\n    this.mapData();\n    this.panelController.render();\n  }\n\n  onRefresh( ){\n    this.mapData();\n    this.panelController.render();\n  }\n\n  mapData(){\n    if(this.panelController.panel.data.processingOnGoing == true) {\n       window.setTimeout(onDataReceived, 100); /* this checks the flag every 100 milliseconds*/\n    } else {\n      this.panel.mappedData = [];\n\n      if(this.panelController.panel.mapping.mapByAlias == true){\n        for( var i in this.panel.targets){\n          let correspondance = this.panel.targets[i];\n          correspondance.series = correspondance.refId+\"-series\";\n          let index = this.panel.data.map( function(s){return(s['metric']);}).indexOf( correspondance.series);\n\n          if( index != -1){\n            let t = {};\n            t['identificador'] = correspondance.alias;\n            t['valor'] = this.panel.data[index]['value'];\n            this.panel.mappedData.push(t);\n          }\n        }\n      }else{\n        for( var i in this.panel.valueMaps){\n          var correspondance = this.panel.valueMaps[i];\n          let index = this.panel.data.map( function(s){return(s['metric']);}).indexOf( correspondance.metric);\n\n          if( index != -1){\n            let t = {};\n            t['identificador'] = correspondance.target;\n            t['valor'] = this.panel.data[index]['value'];\n            this.panel.mappedData.push(t);\n          }\n        }\n      }\n    }\n  }\n}\n"]}